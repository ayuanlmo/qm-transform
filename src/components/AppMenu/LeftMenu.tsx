import * as React from "react";
import {useRef} from "react";
import SystemSetting from "../SystemSetting";
import RouterConfig, {IRouterItem} from "../../router/Config";
import {useTranslation} from "react-i18next";
import {useLocation, useNavigate} from "react-router-dom";
import {useSelector} from "react-redux";
import {RootState} from "../../store";
import {Tooltip} from "@fluentui/react-components";
import About, {IAboutRef} from "../About";

interface IMenuItemProps {
    path: any;
    name: string;
    icon: string;
    isActive: boolean;
    showTooltip: boolean;
}

const MenuItem: React.FC<IMenuItemProps> = (
    {
        path,
        name,
        icon,
        isActive,
        showTooltip
    }
): React.JSX.Element => {
    const {t} = useTranslation();
    const navigate = useNavigate();

    const resolveStaticPath = (p: string): string => {
        if (!p) return p;
        // 在打包后的 file:// 协议下，去掉开头的 /，改为相对路径，从 build 目录加载静态资源
        if (window.location.protocol === 'file:' && p.startsWith('/'))
            return `.${p}`;

        return p;
    };

    const menuItemContent: React.JSX.Element =
        <div
            className={`main-menu-content-item app_position_relative app_flex_box app_cursor_pointer ${isActive ? ' main-menu-content-item-active' : ''}`}
            onClick={(): void => void navigate(path)}
        >
            <div className={'main-menu-content-item-ico'}>
                <img
                    src={resolveStaticPath(icon)}
                    alt="icon"
                />
            </div>
            <div className={'main-menu-content-item-name'}>
                {t(name)}
            </div>
        </div>;

    return showTooltip ?
        <Tooltip
            withArrow
            positioning={'after'}
            content={t(name)}
        >
            {menuItemContent}
        </Tooltip> : menuItemContent;
};

const LeftMenu: React.FC = (): React.JSX.Element => {
    const location = useLocation();
    const {theme: {navigationAppearance}} = useSelector((state: RootState) => state.app.currentSettingConfig);
    const menuCollapse = navigationAppearance === 'collapse';
    const aboutDialogRef = useRef<IAboutRef>(null);

    return (
        <div
            className={`main-menu app_none_user_select app_position_relative ${menuCollapse ? 'main-menu-collapse' : ''}`}>
            <div className={'main-menu-app-logo'}>
                <div>
                    <img
                        onClick={() => {
                            aboutDialogRef.current?.open?.();
                        }}
                        className={'app_cursor_pointer'}
                        src={window.location.protocol === 'file:' ? './icon.svg' : '/icon.svg'}
                        alt="logo"
                    />
                </div>
            </div>
            <div className={'main-menu-app-name'}>
                <div>
                    <svg width="156" height="19" viewBox="0 0 156 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.1436 18.3503L8.92026 16.7191C7.9008 17.5347 6.67745 17.7386 5.25021 17.7386C3.21129 17.7386 1.78405 17.1269 0.968486 15.9036C-0.458756 14.0685 -0.0509729 11.8257 0.560702 8.97124C0.968486 5.91286 1.37627 3.67005 3.41519 2.03892C5.04632 0.815567 6.67745 0 8.51248 0C10.5514 0 11.7747 0.611675 12.7942 1.83503C14.2214 3.67005 13.8137 5.70897 13.202 8.76734C12.7942 11.4179 12.3864 13.253 10.9592 14.8841L12.1825 16.3113L10.1436 18.3503ZM9.93972 4.07783C9.73583 3.46616 8.92026 3.05838 8.1047 3.05838C7.08524 3.05838 6.26967 3.46616 5.658 4.07783C4.84243 4.68951 4.43465 5.50508 3.82297 8.97124C3.21129 12.4374 3.21129 13.0491 3.82297 13.8646C4.23075 14.4763 4.84243 14.8841 5.86189 14.8841C6.26967 14.8841 6.67745 14.8841 7.08524 14.4763L5.86189 12.8452L8.1047 11.0102L9.12416 12.2335C9.53194 11.4179 9.73583 10.3985 10.1436 8.76734C10.5514 5.50508 10.5514 4.68951 9.93972 4.07783Z" fill="#707A85"/>
                        <path d="M27.4747 17.5345L29.3097 7.33994L24.8241 13.8645H22.5813L20.5424 7.33994L18.7074 17.5345H15.2412L18.5035 0.203735H21.7657L24.6202 9.58275L30.9409 0.203735H34.2031L30.9409 17.5345H27.4747Z" fill="#707A85"/>
                        <path d="M35.4263 12.0297L36.0379 8.97131H43.5819L42.9703 12.0297H35.4263Z" fill="#707A85"/>
                        <path d="M49.087 17.5346C46.4364 17.5346 45.8247 15.6995 46.0286 13.8645L47.252 7.54388H45.8247L46.2325 5.09717H47.6597L48.2714 1.42712H51.5337L50.922 5.30107H53.1648L52.757 7.74777H50.5142L49.2909 13.8645C49.087 14.6801 49.4948 15.0879 50.1064 15.0879H51.3298L50.922 17.5346H49.087Z" fill="#707A85"/>
                        <path d="M62.5442 8.3595C62.1364 7.95172 61.7286 7.54394 60.9131 7.54394C59.8936 7.54394 58.6703 8.3595 58.4664 9.99064L57.0391 17.5346H53.7769L56.2236 4.68945H59.2819L59.078 6.1167C59.8936 5.30113 61.117 4.68945 62.5442 4.68945C63.7676 4.68945 64.5831 5.09724 65.3987 5.9128L62.5442 8.3595Z" fill="#707A85"/>
                        <path d="M71.3112 17.5346L71.5151 16.5152C70.4957 17.3307 69.6801 17.7385 68.2529 17.7385C66.8256 17.7385 65.8062 17.3307 65.1945 16.5152C64.5828 15.9035 64.3789 14.6801 64.5828 13.6607C64.9906 11.6218 66.6217 9.99064 69.6801 9.99064H72.7385L72.9424 9.37896C73.1463 7.95172 72.5346 7.34005 70.9034 7.34005C69.6801 7.34005 69.0684 7.54394 68.2529 8.3595L66.6217 6.32059C67.8451 5.09724 69.2723 4.68945 71.3112 4.68945C74.9813 4.68945 76.4085 6.1167 75.7969 9.17507L74.1657 17.5346H71.3112ZM72.1268 12.2334H69.6801C68.4567 12.2334 67.8451 12.8451 67.6412 13.6607C67.4373 14.4763 68.049 15.0879 69.2723 15.0879C70.0879 15.0879 70.6996 15.0879 71.3112 14.4763C71.719 14.0685 71.9229 13.6607 72.1268 12.8451V12.2334Z" fill="#707A85"/>
                        <path d="M85.1758 17.5346L86.6031 9.78675C87.0109 7.95172 85.9914 7.54394 84.9719 7.54394C83.9525 7.54394 82.7291 8.15561 82.3214 9.78675L80.8941 17.5346H77.6318L80.0785 4.68945H83.1369V6.1167C84.1564 5.30113 85.3797 4.89335 86.6031 4.89335C87.8264 4.89335 88.8459 5.30113 89.4576 6.1167C90.2731 7.13615 90.2731 8.3595 90.0692 9.78675L88.4381 17.9424H85.1758V17.5346Z" fill="#707A85"/>
                        <path d="M95.9825 17.7385C93.9436 17.7385 92.1086 17.5346 90.8853 15.9035L93.332 13.8646C94.1475 14.884 95.5748 15.0879 96.5942 15.0879C97.6137 15.0879 98.837 14.6801 99.0409 13.8646C99.2448 13.2529 98.837 12.8451 97.8176 12.6412L95.7787 12.4373C93.7397 12.2334 92.3125 11.214 92.9242 8.76729C93.332 6.1167 95.9826 4.68945 98.6331 4.68945C100.672 4.68945 102.303 5.09724 103.119 6.1167L100.876 8.15561C100.264 7.54394 99.2448 7.34005 98.0215 7.34005C96.7981 7.34005 96.1864 7.95172 95.9825 8.5634C95.9825 8.97118 95.9825 9.58285 97.002 9.58285L99.0409 9.78675C101.488 9.99064 102.507 11.4179 102.099 13.4568C101.692 16.3113 99.0409 17.7385 95.9825 17.7385Z" fill="#707A85"/>
                        <path d="M109.438 7.74789L107.603 17.7386H104.341L106.176 7.74789H104.952L105.36 5.30118H106.584L106.788 3.67005C107.399 1.83503 108.826 0 111.477 0H113.312L112.904 2.65059H111.681C110.865 2.65059 110.458 3.05838 110.458 3.87394L110.254 5.30118H112.7L112.293 7.74789H109.438Z" fill="#707A85"/>
                        <path d="M121.061 16.1074C120.042 16.923 118.615 17.7385 116.78 17.7385C114.945 17.7385 113.721 16.923 113.11 16.1074C112.09 14.884 112.09 13.4568 112.498 11.214C112.906 8.97118 113.517 7.54394 114.945 6.32059C115.964 5.50502 117.391 4.68945 119.226 4.68945C121.061 4.68945 122.285 5.50502 122.896 6.32059C123.916 7.54394 123.916 8.97118 123.508 11.214C123.1 13.4568 122.489 15.0879 121.061 16.1074ZM120.042 8.15561C119.838 7.74783 119.226 7.54394 118.615 7.54394C118.003 7.54394 117.391 7.74783 116.984 8.15561C116.168 8.76729 115.964 9.99064 115.76 11.214C115.556 12.4373 115.352 13.6607 115.964 14.2724C116.168 14.6801 116.78 14.884 117.391 14.884C118.003 14.884 118.615 14.6801 119.022 14.2724C119.838 13.6607 120.042 12.4373 120.246 11.214C120.45 9.99064 120.654 8.76729 120.042 8.15561Z" fill="#707A85"/>
                        <path d="M133.906 8.3595C133.498 7.95172 133.09 7.54394 132.275 7.54394C131.255 7.54394 130.032 8.3595 129.828 9.99064L128.401 17.5346H125.139L127.585 4.68945H130.644V6.1167C131.459 5.30113 132.683 4.68945 134.11 4.68945C135.333 4.68945 136.149 5.09724 136.964 5.9128L133.906 8.3595Z" fill="#707A85"/>
                        <path d="M151.237 17.5346L152.664 9.78675C153.072 7.95172 152.053 7.54394 151.033 7.54394C150.014 7.54394 148.79 8.15561 148.383 9.78675L146.955 17.5346H143.693L145.12 9.78675C145.528 8.15561 144.713 7.54394 143.693 7.54394C142.674 7.54394 141.45 8.15561 141.043 9.78675L139.615 17.5346H136.353L138.8 4.68945H141.858L141.654 6.1167C142.674 5.30113 143.897 4.89335 145.12 4.89335C146.548 4.89335 147.567 5.50502 148.179 6.52448C149.402 5.30113 150.625 4.89335 152.257 4.89335C153.48 4.89335 154.499 5.30113 155.111 6.1167C155.927 7.13615 156.131 8.3595 155.927 9.78675L154.295 17.9424H151.237V17.5346Z" fill="#707A85"/>
                    </svg>
                </div>
            </div>
            <div className={'main-menu-content'}>
                {
                    RouterConfig.map((menuItem: IRouterItem) => {
                        const {path, icon, name} = menuItem;

                        return (
                            <MenuItem
                                key={path}
                                path={path}
                                icon={icon}
                                name={name}
                                showTooltip={menuCollapse}
                                isActive={location.pathname === menuItem.path}
                            />
                        );
                    })
                }
            </div>
            <About ref={aboutDialogRef}/>
            <SystemSetting/>
        </div>
    );
};

export default LeftMenu;
