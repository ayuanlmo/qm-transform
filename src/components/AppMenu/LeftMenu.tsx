import * as React from "react";
import {useRef} from "react";
import SystemSetting from "../SystemSetting";
import RouterConfig, {IRouterItem} from "../../router/Config";
import {useTranslation} from "react-i18next";
import {useLocation, useNavigate} from "react-router-dom";
import {useSelector} from "react-redux";
import {RootState} from "../../store";
import {Tooltip} from "@fluentui/react-components";
import About, {IAboutRef} from "../About";

interface IMenuItemProps {
    path: any;
    name: string;
    icon: string;
    isActive: boolean;
    showTooltip: boolean;
}

const MenuItem: React.FC<IMenuItemProps> = (
    {
        path,
        name,
        icon,
        isActive,
        showTooltip
    }
): React.JSX.Element => {
    const {t} = useTranslation();
    const navigate = useNavigate();

    const resolveStaticPath = (p: string): string => {
        if (!p) return p;
        // 在打包后的 file:// 协议下，去掉开头的 /，改为相对路径，从 build 目录加载静态资源
        if (window.location.protocol === 'file:' && p.startsWith('/'))
            return `.${p}`;

        return p;
    };

    const menuItemContent: React.JSX.Element =
        <div
            className={`main-menu-content-item app_position_relative app_flex_box app_cursor_pointer ${isActive ? ' main-menu-content-item-active' : ''}`}
            onClick={(): void => void navigate(path)}
        >
            <div className={'main-menu-content-item-ico'}>
                <img
                    src={resolveStaticPath(icon)}
                    alt="icon"
                />
            </div>
            <div className={'main-menu-content-item-name'}>
                {t(name)}
            </div>
        </div>;

    return showTooltip ?
        <Tooltip
            withArrow
            positioning={'after'}
            content={t(name)}
            relationship={"label"}
        >
            {menuItemContent}
        </Tooltip> : menuItemContent;
};

const LeftMenu: React.FC = (): React.JSX.Element => {
    const location = useLocation();
    const {theme: {navigationAppearance}} = useSelector((state: RootState) => state.app.currentSettingConfig);
    const menuCollapse = navigationAppearance === 'collapse';
    const aboutDialogRef = useRef<IAboutRef>(null);

    return (
        <div
            className={`main-menu app_none_user_select app_position_relative ${menuCollapse ? 'main-menu-collapse' : ''}`}>
            <div className={'main-menu-app-logo'}>
                <div>
                    <img
                        onClick={() => {
                            aboutDialogRef.current?.open?.();
                        }}
                        className={'app_cursor_pointer'}
                        src={window.location.protocol === 'file:' ? './icon.svg' : '/icon.svg'}
                        alt="logo"
                    />
                </div>
            </div>
            <div className={'main-menu-app-name'}>
                <div>
                    <svg width="156" height="19" viewBox="0 0 156 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13.1191 8.66664C12.5888 11.2444 12.1738 13.1777 10.9979 14.6666L12.0585 16.0222L9.68371 18.0222L8.53089 16.5555C7.56252 17 6.45581 17.2222 5.48744 17.2222C1.89063 17.2 0 14.8222 0 12.2889C0 11.5333 0.161395 10.2889 0.507242 8.64442C1.12977 5.73331 1.5909 3.59997 3.20485 2.04442C4.56518 0.733306 6.52498 0.111084 8.13893 0.111084C11.7357 0.111084 13.6264 2.48886 13.6264 5.02219C13.6264 5.77775 13.465 7.02219 13.1191 8.66664ZM7.81614 3.55553C7.12445 3.55553 6.50192 3.88886 6.06385 4.35553C5.53355 4.91108 5.21076 5.79997 4.58824 8.64442C4.40378 9.6222 4.12711 11.0666 4.12711 11.9555C4.12711 13.1111 4.86491 13.7555 5.83328 13.7555C5.97162 13.7555 6.13302 13.7333 6.27136 13.7111L5.30299 12.4889L7.6778 10.4889L8.41561 11.4C8.60006 10.7555 8.80757 9.88886 9.08425 8.66664C9.2687 7.68886 9.54537 6.24442 9.54537 5.35553C9.52232 4.19997 8.78451 3.55553 7.81614 3.55553Z" fill="#707A85"/>
                        <path d="M29.6505 17.0667H25.5925L27.2987 8.77783L24.1861 12.9334H21.6038L20.0129 8.77783L18.2836 17.0667H14.2026L17.7072 0.266724H21.5115L23.748 7.66672L29.1893 0.266724H33.1781L29.6505 17.0667Z" fill="#707A85"/>
                        <path d="M41.1791 11.8223H33.5474L34.2621 8.37781H41.8938L41.1791 11.8223Z" fill="#707A85"/>
                        <path d="M56.8801 3.73339H52.8913L50.1245 17.0667H46.0666L48.8334 3.73339H44.6602L45.398 0.266724H57.6179L56.8801 3.73339Z" fill="#707A85"/>
                        <path d="M64.466 8.28883C64.3046 8.13327 63.9818 7.57772 63.244 7.57772C62.3679 7.57772 61.4456 8.26661 61.215 9.46661L59.6472 17.0666H55.8198L58.4483 4.37772H62.1142L61.8837 5.46661C62.5754 4.71105 63.7743 4.24438 65.0194 4.24438C66.2644 4.24438 67.0714 4.62216 67.7861 5.44438L64.466 8.28883Z" fill="#707A85"/>
                        <path d="M78.369 9.06672L76.7089 17.0667H73.0429L73.2735 16.0223C72.651 16.6223 71.7287 17.1778 70.4145 17.1778C68.0166 17.1778 66.7485 15.4223 66.7485 13.7112C66.7485 12.3556 67.1866 11.3556 67.9244 10.6667C68.8467 9.80006 70.2531 9.40006 71.7748 9.40006H74.4724L74.5647 8.95561C74.6108 8.77783 74.6338 8.62228 74.6338 8.42228C74.6338 7.77783 74.2188 7.31117 73.066 7.31117C71.9593 7.31117 71.1062 7.77783 70.622 8.33339L68.7083 5.88895C69.7228 4.97783 71.1062 4.26672 73.6885 4.26672C76.0864 4.26672 78.5073 5.26672 78.5073 7.93339C78.5304 8.26672 78.4382 8.71117 78.369 9.06672ZM72.0976 11.8445C70.9909 11.8445 70.4606 12.5778 70.4606 13.2889C70.4606 13.8001 70.8526 14.2223 71.6135 14.2223C72.3282 14.2223 72.8816 13.9112 73.2505 13.5556C73.5963 13.2223 73.7808 12.7112 73.896 12.1778L73.9652 11.8223H72.0976V11.8445Z" fill="#707A85"/>
                        <path d="M91.7186 9.17772L90.0816 17.0666H86.2542L87.8451 9.39994C87.8912 9.17772 87.9143 8.9555 87.9143 8.7555C87.9143 7.91105 87.2918 7.5555 86.8076 7.5555C85.9314 7.5555 85.0784 7.97772 84.7786 9.39994L83.1877 17.0666H79.3604L81.9888 4.37772H85.6317L85.4011 5.48883C86.2312 4.68883 87.4762 4.24438 88.629 4.24438C89.9202 4.24438 91.8569 5.08883 91.8569 7.73327C91.88 8.24438 91.8108 8.7555 91.7186 9.17772Z" fill="#707A85"/>
                        <path d="M101.679 8.08884C101.218 7.53328 100.18 7.24439 99.4656 7.24439C98.2205 7.24439 97.7133 7.68883 97.7133 8.22217C97.7133 8.57772 97.9669 8.82217 98.5203 8.91106L100.18 9.19995C102.532 9.59995 103.362 10.9333 103.362 12.5999C103.362 14.0444 102.717 15.0888 101.887 15.8222C100.78 16.8444 98.9353 17.2222 97.2522 17.2222C94.8082 17.2222 93.2403 16.5111 92.0645 15.2888L94.7851 12.9777C95.3154 13.5999 96.1454 14.0666 97.5058 14.0666C98.8431 14.0666 99.5578 13.5555 99.5578 13.0222C99.5578 12.5777 99.212 12.3555 98.6586 12.2666L96.9985 11.9777C94.7851 11.5999 93.8859 10.3333 93.8859 9.04439C93.8859 7.77772 94.347 6.62217 95.2924 5.71106C96.3299 4.71106 97.9439 4.22217 99.7884 4.22217C101.725 4.22217 103.085 4.64439 104.261 5.86661L101.679 8.08884Z" fill="#707A85"/>
                        <path d="M113.691 3.08889H112.492C111.916 3.08889 111.547 3.42222 111.409 4.02222L111.247 4.88889H113.322L112.746 7.73333H110.671L108.734 17.0444H104.907L106.843 7.73333H105.691L106.267 4.91111H107.42L107.697 3.62222C108.112 1.57778 109.38 0 112.262 0H114.337L113.691 3.08889Z" fill="#707A85"/>
                        <path d="M124.459 10.7111C123.975 13.2444 123.375 14.5333 122.176 15.6888C121.254 16.5777 119.801 17.1999 117.98 17.1999C115.697 17.1999 113.392 15.8444 113.392 12.9999C113.392 12.2222 113.53 11.3111 113.668 10.7111C114.152 8.17772 114.752 6.88883 115.951 5.73328C116.873 4.84439 118.326 4.22217 120.147 4.22217C122.43 4.22217 124.735 5.57772 124.735 8.42217C124.712 9.19995 124.574 10.1333 124.459 10.7111ZM119.755 7.5555C119.271 7.5555 118.879 7.68883 118.579 7.97772C118.049 8.46661 117.749 9.42217 117.473 10.7111C117.219 11.9555 117.196 12.3777 117.196 12.5555C117.196 13.3777 117.588 13.8666 118.372 13.8666C118.856 13.8666 119.248 13.7333 119.548 13.4444C120.078 12.9555 120.378 11.9999 120.654 10.7111C120.908 9.46661 120.931 9.04439 120.931 8.86661C120.931 8.04439 120.539 7.5555 119.755 7.5555Z" fill="#707A85"/>
                        <path d="M134.258 8.28883C134.097 8.13327 133.774 7.57772 133.036 7.57772C132.16 7.57772 131.238 8.26661 131.007 9.46661L129.439 17.0666H125.612L128.24 4.37772H131.906L131.676 5.46661C132.367 4.71105 133.566 4.24438 134.811 4.24438C136.056 4.24438 136.863 4.62216 137.578 5.44438L134.258 8.28883Z" fill="#707A85"/>
                        <path d="M155.839 9.17772L154.202 17.0666H150.374L151.965 9.39994C152.011 9.17772 152.034 8.9555 152.034 8.7555C152.034 7.91105 151.412 7.5555 150.928 7.5555C150.051 7.5555 149.198 7.97772 148.899 9.39994L147.308 17.0666H143.48L145.071 9.39994C145.117 9.17772 145.14 8.9555 145.14 8.7555C145.14 7.91105 144.518 7.5555 144.034 7.5555C143.158 7.5555 142.304 7.97772 142.005 9.39994L140.414 17.0666H136.586L139.215 4.37772H142.858L142.627 5.48883C143.457 4.68883 144.702 4.24438 145.855 4.24438C146.524 4.24438 147.723 4.48883 148.461 5.62216C149.267 4.91105 150.305 4.24438 152.334 4.24438C153.948 4.24438 155.977 5.28883 155.977 7.73327C156 8.31105 155.908 8.79994 155.839 9.17772Z" fill="#707A85"/>
                    </svg>
                </div>
            </div>
            <div className={'main-menu-content'}>
                {
                    RouterConfig.map((menuItem: IRouterItem) => {
                        const {path, icon, name} = menuItem;

                        return (
                            <MenuItem
                                key={path}
                                path={path}
                                icon={icon}
                                name={name}
                                showTooltip={menuCollapse}
                                isActive={location.pathname === menuItem.path}
                            />
                        );
                    })
                }
            </div>
            <About ref={aboutDialogRef}/>
            <SystemSetting/>
        </div>
    );
};

export default LeftMenu;
